<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="A comprehensive community-driven glossary of game development terms and concepts." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <title>Game Development Glossary</title>
    <style>
      :root {
        --c-bg: #14151a;
        --c-text-dark: #14151a;
        --c-prim: #c44848;

        --border-width: 2px;
      }

      * {
        margin: 0;
        padding: 0;
        font-weight: 400;
        box-sizing: border-box;
      }

      html,
      body,
      input,
      textarea,
      select,
      button {
        font-family: "Poppins", sans-serif;
        font-size: 18px;
      }

      body {
        background-color: var(--c-bg);
      }

      body > main {
        padding: 2em;
        display: flex;
        max-width: 80ch;
        flex-direction: column;
        min-height: 100vh;
        margin: 0 auto;
      }

      p {
        max-width: 60ch;
      }

      p {
        max-width: 60ch;
      }

      .totd {
        width: 100%;
        color: var(--c-text-dark);
      }

      .totd > header {
        width: max-content;
        background-color: var(--c-prim);
        padding: 0.1em 0.6em;
        margin-bottom: 0.2em;
      }

      .totd > main {
        background-color: var(--c-prim);
        padding: 0.2em 0.6em;
      }

      .totd > main > p {
        padding: 1em 0;
        text-align: left;
      }

      .totd > main > h1 {
        font-size: 4rem;
      }

      .totd > main > p {
        padding: 1em 0;
      }

      hr {
        border: none;
        height: var(--border-width);
        background-color: #3e4146;
      }

      .search-and-filter {
        display: flex;
        flex-direction: column;
        width: 100%;
        margin: 3em 0 2em 0;
      }

      .search {
        width: 100%;
        display: flex;
        align-items: center;
        gap: 0.5em;
        padding: 0.4em;
        border: var(--border-width) solid #3e4146;
        background: hsl(228, 12%, 8%);
      }

      .search input {
        flex-grow: 1;
        background: none;
        border: none;
        outline: none;
        font-size: 1rem;
        color: #a7a7a796;
      }

      .search input::-webkit-search-cancel-button {
        -webkit-appearance: none;
        appearance: none;
        height: 18px;
        width: 18px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236a6a6a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E%3C/svg%3E");
        background-size: 18px 18px;
        background-repeat: no-repeat;
        cursor: pointer;
        opacity: 0.6;
      }

      .search input::-webkit-search-cancel-button:hover {
        opacity: 1;
      }

      .search kbd {
        border: var(--border-width) solid #3e4146;
        background-color: var(--c-bg);
        color: #a7a7a796;
        padding: 0.2em 0.4em;
        font-size: 0.8rem;
      }

      .filter-and-sort {
        width: 100%;
        display: flex;
        align-items: center;
        padding: 0.4em 0.2em 0.4em 0;
        color: #3e4146;
        gap: 0.7em;
      }

      .filter-and-sort a {
        text-decoration: none;
        color: #3e4146;
        transition: color 0.2s ease;
        cursor: pointer;
      }

      .filter-and-sort a:hover {
        color: var(--c-prim);
      }

      .filter-and-sort svg {
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .filter-and-sort svg:hover path,
      .filter-and-sort svg:hover rect {
        stroke: var(--c-prim);
      }

      .filter-and-sort svg.active path,
      .filter-and-sort svg.active rect {
        stroke: var(--c-prim);
      }

      .filter-and-sort hr {
        flex-grow: 1;
      }

      .terms-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .term-item {
        display: flex;
        flex-direction: row;
        position: relative;
        border: var(--border-width) solid #3e4146;
        padding: 1em 0;
        margin-top: 0.7em;
        opacity: 0;
        animation: fadeInUp 0.5s ease-out forwards;
      }

      .term-item[data-totd="true"]::after {
        content: "term of the day";
        position: absolute;
        top: 0;
        right: -48px;
        height: calc(100% + 2 * var(--border-width));
        width: 48px;
        background: var(--c-prim);
        color: var(--c-text-dark);
        display: flex;
        justify-content: center;
        align-items: center;
        transform: translateY(calc(-1 * var(--border-width)));
        writing-mode: vertical-rl;
        text-orientation: mixed;
      }

      .term-item .content {
        flex-grow: 1;
        padding: 0 0 0 1.5em;
      }

      .term-item .content > h2 {
        font-size: 2rem;
        color: #c2c2c2;
        margin: 0;
        text-transform: lowercase;
      }

      .term-item .content > h2::before {
        content: "[";
        padding-right: 0.2em;
      }

      .term-item .content > h2::after {
        content: "]";
        padding-left: 0.2em;
      }

      .term-item .tags {
        list-style: none;
        display: flex;
        margin: 0;
        padding: 0;
      }

      .term-item .tags li {
        color: #c2c2c2;
      }

      .term-item .tags li::after {
        content: "\00b7";
        padding: 0 0.5em;
        font-weight: bold;
      }

      .term-item .tags li:last-child::after {
        content: "";
      }

      .term-item .content > p {
        padding: 1em 0;
        color: #7a7d84;
        max-width: 60ch;
        margin: 0;
      }

      .term-item .votes {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.8em;
        padding: 0 1.5em;
        color: #c2c2c2;
      }

      .term-item .votes button {
        background: none;
        border: none;
        cursor: pointer;
        color: #c2c2c2;
        padding: 0;
      }

      .term-item .votes button:hover {
        color: #ffffff;
      }

      .term-item .letter {
        display: none;
      }

      .term-item.show-letter .letter {
        display: block;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .suggest-term {
        background-color: var(--c-prim);
        color: var(--c-text-dark);
        margin-top: auto;
        padding: 0.6em 1.2em;
        text-align: center;
        border: none;
        width: max-content;
        cursor: pointer;
      }

      .suggest-term:hover {
        opacity: 0.9;
      }

      dialog {
        background-color: hsl(228, 12%, 12%);
        border: var(--border-width) solid #3e4146;
        color: #c2c2c2;
        padding: 0;
        max-width: 600px;
        width: 90%;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        margin: 0;
      }

      dialog::backdrop {
        background-color: rgba(0, 0, 0, 0.7);
      }

      dialog header {
        background-color: var(--c-prim);
        color: var(--c-text-dark);
        padding: 0.8em 1.2em;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      dialog header h2 {
        margin: 0;
        font-size: 1.5rem;
      }

      dialog header button {
        background: none;
        border: none;
        color: var(--c-text-dark);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      dialog form {
        padding: 1.5em;
        display: flex;
        flex-direction: column;
        gap: 1.2em;
      }

      dialog .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.4em;
      }

      dialog label {
        color: #c2c2c2;
        font-size: 0.9rem;
      }

      dialog input,
      dialog textarea {
        background-color: hsl(228, 12%, 8%);
        border: var(--border-width) solid #3e4146;
        color: #c2c2c2;
        padding: 0.6em;
        font-family: "Poppins", sans-serif;
        font-size: 1rem;
      }

      dialog input:focus,
      dialog textarea:focus {
        outline: none;
        border-color: var(--c-prim);
      }

      dialog textarea {
        resize: vertical;
        min-height: 100px;
      }

      dialog .form-actions {
        display: flex;
        gap: 0.8em;
        justify-content: flex-end;
        margin-top: 0.5em;
      }

      dialog button[type="submit"] {
        background-color: var(--c-prim);
        color: var(--c-text-dark);
        border: none;
        padding: 0.6em 1.5em;
        cursor: pointer;
        font-family: "Poppins", sans-serif;
        font-size: 1rem;
      }

      dialog button[type="button"] {
        background-color: transparent;
        color: #7a7d84;
        border: var(--border-width) solid #3e4146;
        padding: 0.6em 1.5em;
        cursor: pointer;
        font-family: "Poppins", sans-serif;
        font-size: 1rem;
      }

      dialog button:hover {
        opacity: 0.9;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3em;
        color: #7a7d84;
        gap: 0.5em;
      }

      .loading-dots {
        display: flex;
        gap: 0.3em;
      }

      .loading-dots span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: var(--c-prim);
        animation: loading-bounce 1.4s infinite ease-in-out both;
      }

      .loading-dots span:nth-child(1) {
        animation-delay: -0.32s;
      }

      .loading-dots span:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes loading-bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      .back-to-top {
        position: fixed;
        bottom: 2em;
        right: 2em;
        width: 48px;
        height: 48px;
        padding: 8px;
        display: none;
        background: var(--c-prim);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        z-index: 1000;
        aspect-ratio: 1 / 1;
      }

      .back-to-top svg {
        width: 100%;
        height: 100%;
        color: var(--c-text-dark)
      }
    </style>
  </head>

  <body>
    <main>
      <div class="totd">
        <header>term of the day</header>
        <main>
          <h1><u>affordance</u></h1>
          <p>
            The properties of an object that suggest how it can be used, acting
            as a clue for interaction.
          </p>
        </main>
      </div>

      <!-- Search, Filter and Sort -->
      <div class="search-and-filter">
        <div class="search">
          <svg
            width="28"
            height="28"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M17.5 17.5L13.8833 13.8833"
              stroke="#6A6A6A"
              style="
                stroke: #6a6a6a;
                stroke: color(display-p3 0.4151 0.4151 0.4151);
                stroke-opacity: 1;
              "
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M9.16667 15.8333C12.8486 15.8333 15.8333 12.8486 15.8333 9.16667C15.8333 5.48477 12.8486 2.5 9.16667 2.5C5.48477 2.5 2.5 5.48477 2.5 9.16667C2.5 12.8486 5.48477 15.8333 9.16667 15.8333Z"
              stroke="#6A6A6A"
              style="
                stroke: #6a6a6a;
                stroke: color(display-p3 0.4151 0.4151 0.4151);
                stroke-opacity: 1;
              "
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <input type="search" placeholder="Search 242 terms..." />
          <kbd>Ctrl + F</kbd>
        </div>
        <div class="filter-and-sort">
   
          <svg xmlns="http://www.w3.org/2000/svg" class="sort-az-btn" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down-az-icon lucide-arrow-down-a-z"><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="M20 8h-5"/><path d="M15 10V6.5a2.5 2.5 0 0 1 5 0V10"/><path d="M15 14h5l-5 6h5"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" class="sort-votes-btn" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down10-icon lucide-arrow-down-1-0"><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="M17 10V4h-2"/><path d="M15 10h4"/><rect x="15" y="14" width="4" height="6" ry="2"/></svg>
         
          <hr />
          <a href="#A" class="letter-nav">A</a>
          <a href="#B" class="letter-nav">B</a>
          <a href="#C" class="letter-nav">C</a>
          <a href="#D" class="letter-nav">D</a>
          <a href="#E" class="letter-nav">E</a>
          <a href="#F" class="letter-nav">F</a>
          <a href="#G" class="letter-nav">G</a>
          <a href="#H" class="letter-nav">H</a>
          <a href="#I" class="letter-nav">I</a>
          <a href="#J" class="letter-nav">J</a>
          <a href="#K" class="letter-nav">K</a>
          <a href="#L" class="letter-nav">L</a>
          <a href="#M" class="letter-nav">M</a>
          <a href="#N" class="letter-nav">N</a>
          <a href="#O" class="letter-nav">O</a>
          <a href="#P" class="letter-nav">P</a>
          <a href="#Q" class="letter-nav">Q</a>
          <a href="#R" class="letter-nav">R</a>
          <a href="#S" class="letter-nav">S</a>
          <a href="#T" class="letter-nav">T</a>
          <a href="#U" class="letter-nav">U</a>
          <a href="#V" class="letter-nav">V</a>
          <a href="#W" class="letter-nav">W</a>
          <a href="#X" class="letter-nav">X</a>
          <a href="#Y" class="letter-nav">Y</a>
          <a href="#Z" class="letter-nav">Z</a>
        </div>
      </div>

      <!-- Terms List -->
      <hr />
      <ul class="terms-list">
        <div class="loading">
          <span>Loading terms</span>
          <div class="loading-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </ul>

      <template id="term-template">
        <li class="term-item">
          <h2 class="letter" style="position: absolute; font-size: 4rem; font-weight: 200; line-height: 110%; left: -2ch; top: 0px; color: var(--c-prim);">
            A
          </h2>
          <div class="content">
            <h2 class="term-name"></h2>
            <ul class="tags"></ul>
            <p class="term-definition"></p>
          </div>
          <div class="votes">
            <button class="vote-up" aria-label="Vote up">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="m5 12 7-7 7 7" />
                <path d="M12 19V5" />
              </svg>
            </button>
            <div class="vote-count">0</div>
            <button class="vote-down" aria-label="Vote down">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M12 5v14" />
                <path d="m19 12-7 7-7-7" />
              </svg>
            </button>
          </div>
        </li>
      </template>

      <div style="display: flex; justify-content: center; margin-top: 2em">
        <button class="suggest-term" id="suggestTermBtn">
          + Suggest a Term
        </button>
      </div>

      <dialog id="suggestDialog">
        <header>
          <h2>Suggest a Term</h2>
          <button type="button" id="closeDialog" aria-label="Close">×</button>
        </header>
        <form id="suggestForm">
          <div class="form-group">
            <label for="termName">Term *</label>
            <input
              type="text"
              id="termName"
              name="term"
              required
              placeholder="e.g., affordance"
            />
          </div>
          <div class="form-group">
            <label for="termDefinition">Definition *</label>
            <textarea
              id="termDefinition"
              name="definition"
              required
              placeholder="Describe what this term means..."
            ></textarea>
          </div>
          <div class="form-group">
            <label for="termTags">Tags</label>
            <input
              type="text"
              id="termTags"
              name="tags"
              placeholder="e.g., noun, psychology (comma-separated)"
            />
          </div>
          <!--<div class="form-group">
                    <label for="submitterName">Your Name (optional)</label>
                    <input type="text" id="submitterName" name="submitter" placeholder="Anonymous">
                </div>-->
          <div class="form-actions">
            <button type="button" id="cancelBtn">Cancel</button>
            <button type="submit">Submit Suggestion</button>
          </div>
        </form>
      </dialog>

      <div style="flex-grow: 1"></div>

      <footer style="text-align: center; margin-top: 2em">
        <hr />
        <p style="max-width: 100%; padding: 1em 0; color: #6a6a6a">
          © 2024 Khaos Games ApS. All rights reserved.
        </p>
      </footer>
    </main>

    <button class="back-to-top">
 <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="m5 12 7-7 7 7" />
                <path d="M12 19V5" />
              </svg>
    </button>

    <script>
      // Supabase Configuration
      const SUPABASE_URL = "https://uahckisfpkeulrwbuyms.supabase.co";
      const SUPABASE_KEY = "sb_publishable_otX6Z4ozo93AdIhablKqlA_Ah-Ou5CM";
      
      let allTerms = []; // Store all terms for filtering
      let currentSort = 'az'; // Track current sort mode

      // Fetch terms from Supabase
      async function fetchTerms() {
        try {
          // Try different possible table names
          const tableName = "terms";

          try {
            const response = await fetch(
              `${SUPABASE_URL}/rest/v1/terms?select=*`,
              {
                headers: {
                  apikey: SUPABASE_KEY,
                  Authorization: `Bearer ${SUPABASE_KEY}`,
                  Accept: "application/json",
                  "Content-Type": "application/json",
                  Prefer: "return=representation",
                },
              },
            );

            if (response.ok) {
              const terms = await response.json();
              console.log(
                `Successfully fetched ${terms.length} terms from table: ${tableName}`,
              );
              allTerms = terms; // Store globally
              renderTerms(terms);
              return;
            }
          } catch (err) {
            console.log(`Table '${tableName}' not found, trying next...`);
          }

          // If no table worked, show error and use fallback data
          throw new Error("Could not find terms table in Supabase");
        } catch (error) {
          console.error("Error fetching terms:", error);
          console.log("Using fallback data...");
        }
      }
      // Render terms in the list
      function renderTerms(terms, sortMode = currentSort) {
        const termsList = document.querySelector(".terms-list");
        const template = document.getElementById("term-template");
        termsList.innerHTML = "";

        if (terms.length === 0) {
          termsList.innerHTML =
            '<div class="loading"><span>No terms found</span></div>';
          return;
        }

        // Create a copy to avoid mutating the original array
        const sortedTerms = [...terms];

        // Sort terms based on mode
        if (sortMode === 'az') {
          sortedTerms.sort((a, b) => a.term.localeCompare(b.term));
        } else if (sortMode === 'votes') {
          sortedTerms.sort((a, b) => (b.votes || 0) - (a.votes || 0));
        }

        // Only show letter grouping for A-Z sort
        if (sortMode === 'az') {
          // Create placeholder headers for all letters A-Z
          const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
          const letterMap = {};
          
          // Build map of which letters have terms
          sortedTerms.forEach(term => {
            const firstLetter = term.term[0].toUpperCase();
            if (!letterMap[firstLetter]) {
              letterMap[firstLetter] = [];
            }
            letterMap[firstLetter].push(term);
          });

          // Create letter anchors and render terms in order
          alphabet.forEach(letter => {
            const anchor = document.createElement('span');
            anchor.id = letter;
            anchor.style.scrollMarginTop = '2em';
            termsList.appendChild(anchor);
            
            if (letterMap[letter]) {
              // Render terms for this letter
              letterMap[letter].forEach((term, index) => {
                const clone = template.content.cloneNode(true);
                const li = clone.querySelector(".term-item");
                const letterElement = clone.querySelector(".letter");
                
                // Show letter only for first term of each letter group
                if (index === 0) {
                  li.classList.add('show-letter');
                  letterElement.textContent = letter;
                }
                
                // Skip animation (set opacity to 1 immediately)
                li.style.opacity = '1';
                li.style.animation = 'none';
                
                // Set term data
                clone.querySelector(".term-name").textContent = term.term;
                clone.querySelector(".term-definition").textContent = term.description;
                clone.querySelector(".vote-count").textContent = term.votes || 0;
                
                // Set TOTD attribute
                if (term.totd) {
                  li.setAttribute("data-totd", "true");
                }
                
                // Set tags
                const tagsList = clone.querySelector(".tags");
                if (term.tags && term.tags.length > 0) {
                  term.tags.forEach(tag => {
                    const tagLi = document.createElement("li");
                    tagLi.textContent = tag;
                    tagsList.appendChild(tagLi);
                  });
                }
                
                // Set up vote buttons with accessible labels
                const upBtn = clone.querySelector(".vote-up");
                const downBtn = clone.querySelector(".vote-down");
                upBtn.setAttribute("aria-label", `Vote up for ${term.term}`);
                downBtn.setAttribute("aria-label", `Vote down for ${term.term}`);
                
                // Handle voting
                upBtn.addEventListener("click", () => {
                  console.log(`Vote up for term: ${term.term}`);
                  // Add actual voting logic here
                });
                
                downBtn.addEventListener("click", () => {
                  console.log(`Vote down for term: ${term.term}`);
                  // Add actual voting logic here
                });

                termsList.appendChild(clone);
              });
            }
          });
        } else {
          // For votes sorting, render without letter grouping
          sortedTerms.forEach((term) => {
            const clone = template.content.cloneNode(true);
            const li = clone.querySelector(".term-item");
            const letterElement = clone.querySelector(".letter");
            
            // Hide letters for vote sorting
            letterElement.style.display = 'none';
            
            // Skip animation (set opacity to 1 immediately)
            li.style.opacity = '1';
            li.style.animation = 'none';
            
            // Set term data
            clone.querySelector(".term-name").textContent = term.term;
            clone.querySelector(".term-definition").textContent = term.description;
            clone.querySelector(".vote-count").textContent = term.votes || 0;
            
            // Set TOTD attribute
            if (term.totd) {
              li.setAttribute("data-totd", "true");
            }
            
            // Set tags
            const tagsList = clone.querySelector(".tags");
            if (term.tags && term.tags.length > 0) {
              term.tags.forEach(tag => {
                const tagLi = document.createElement("li");
                tagLi.textContent = tag;
                tagsList.appendChild(tagLi);
              });
            }
            
            // Set up vote buttons with accessible labels
            const upBtn = clone.querySelector(".vote-up");
            const downBtn = clone.querySelector(".vote-down");
            upBtn.setAttribute("aria-label", `Vote up for ${term.term}`);
            downBtn.setAttribute("aria-label", `Vote down for ${term.term}`);
            
            // Handle voting
            upBtn.addEventListener("click", () => {
              console.log(`Vote up for term: ${term.term}`);
              // Add actual voting logic here
            });
            
            downBtn.addEventListener("click", () => {
              console.log(`Vote down for term: ${term.term}`);
              // Add actual voting logic here
            });

            termsList.appendChild(clone);
          });
        }
      }

      // Load terms on page load
      document.addEventListener("DOMContentLoaded", () => {
        fetchTerms();

        const cancelBtn = document.getElementById("cancelBtn");
        const form = document.getElementById("suggestForm");
        const searchInput = document.querySelector('.search input');
        const sortAzBtn = document.querySelector('.sort-az-btn');
        const sortVotesBtn = document.querySelector('.sort-votes-btn');
        const letterNavLinks = document.querySelectorAll('.letter-nav');
        const backToTopBtn = document.querySelector('.back-to-top');

        // Letter navigation click handler
        letterNavLinks.forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            // Switch to A-Z sort when clicking letter nav
            currentSort = 'az';
            sortAzBtn.classList.add('active');
            sortVotesBtn.classList.remove('active');
            const query = searchInput.value.toLowerCase().trim();
            const filtered = query === '' ? allTerms : allTerms.filter(term => 
              term.term.toLowerCase().includes(query) || 
              term.description.toLowerCase().includes(query) ||
              (term.tags && term.tags.some(tag => tag.toLowerCase().includes(query)))
            );
            renderTerms(filtered, 'az');
            // Scroll to the letter
            const letter = link.getAttribute('href').substring(1);
            const anchor = document.getElementById(letter);
            if (anchor) {
              anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        });

        // Sort button handlers
        sortAzBtn.addEventListener('click', () => {
          currentSort = 'az';
          sortAzBtn.classList.add('active');
          sortVotesBtn.classList.remove('active');
          const query = searchInput.value.toLowerCase().trim();
          const filtered = query === '' ? allTerms : allTerms.filter(term => 
            term.term.toLowerCase().includes(query) || 
            term.description.toLowerCase().includes(query) ||
            (term.tags && term.tags.some(tag => tag.toLowerCase().includes(query)))
          );
          renderTerms(filtered, currentSort);
        });

        sortVotesBtn.addEventListener('click', () => {
          currentSort = 'votes';
          sortVotesBtn.classList.add('active');
          sortAzBtn.classList.remove('active');
          const query = searchInput.value.toLowerCase().trim();
          const filtered = query === '' ? allTerms : allTerms.filter(term => 
            term.term.toLowerCase().includes(query) || 
            term.description.toLowerCase().includes(query) ||
            (term.tags && term.tags.some(tag => tag.toLowerCase().includes(query)))
          );
          renderTerms(filtered, 'votes');
        });

        // Set A-Z as default active
        sortAzBtn.classList.add('active');

        // Search functionality

          
        // Escape key to blur search input
        searchInput.addEventListener("keydown", (e) => {
          if (e.key === 'Escape' || e.key === 'Enter') {
            searchInput.blur();
          }
        });

        // Open dialog
        const suggestBtn = document.getElementById("suggestTermBtn");
        const dialog = document.getElementById("suggestDialog");
        const closeBtn = document.getElementById("closeDialog");
        // Search functionality
        searchInput.addEventListener("input", (e) => {
          const query = e.target.value.toLowerCase().trim();
          
          if (query === '') {
            // Show all terms
            renderTerms(allTerms, currentSort);
          } else {
            // Filter terms
            const filtered = allTerms.filter(term => 
              term.term.toLowerCase().includes(query) || 
              term.description.toLowerCase().includes(query) ||
              (term.tags && term.tags.some(tag => tag.toLowerCase().includes(query)))
            );
            renderTerms(filtered, currentSort);
          }
        });

        // Open dialog
        suggestBtn.addEventListener("click", () => {
          dialog.showModal();
        });

        // Close dialog
        closeBtn.addEventListener("click", () => {
          dialog.close();
        });

        cancelBtn.addEventListener("click", () => {
          dialog.close();
        });

        // Close on backdrop click
        dialog.addEventListener("click", (e) => {
          if (e.target === dialog) {
            dialog.close();
          }
        });

        // Handle form submission
        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = new FormData(form);
          const termData = {
            term: formData.get("term"),
            description: formData.get("definition"),
            tags: formData.get("tags")
              ? formData
                  .get("tags")
                  .split(",")
                  .map((t) => t.trim())
              : [],
          };

          try {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/terms`, {
              method: "POST",
              headers: {
                apikey: SUPABASE_KEY,
                Authorization: `Bearer ${SUPABASE_KEY}`,
                "Content-Type": "application/json",
                Prefer: "return=representation",
              },
              body: JSON.stringify(termData),
            });

            if (response.ok) {
              alert(
                "Term suggestion submitted successfully! It will be reviewed before being added.",
              );
              form.reset();
              dialog.close();
              fetchTerms(); // Refresh the list
            } else {
              throw new Error("Failed to submit term");
            }
          } catch (error) {
            console.error("Error submitting term:", error);
            alert("Failed to submit term suggestion. Please try again later.");
          }
        });

        // Keyboard navigation for A-Z letters
        document.addEventListener("keydown", (e) => {
          // Ctrl+F to focus search bar
          if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
            e.preventDefault();
            const searchInput = document.querySelector('.search input');
            searchInput.focus();
            searchInput.select();
            return;
          }

          // Only trigger if no input/textarea is focused and dialog is not open
          if (document.activeElement.tagName === 'INPUT' || 
              document.activeElement.tagName === 'TEXTAREA' ||
              dialog.open) {
            return;
          }

          const key = e.key.toUpperCase();
          if (key >= 'A' && key <= 'Z') {
            e.preventDefault();
            // Switch to A-Z sort when a letter is pressed
            currentSort = 'az';
            sortAzBtn.classList.add('active');
            sortVotesBtn.classList.remove('active');
            const query = searchInput.value.toLowerCase().trim();
            const filtered = query === '' ? allTerms : allTerms.filter(term => 
              term.term.toLowerCase().includes(query) || 
              term.description.toLowerCase().includes(query) ||
              (term.tags && term.tags.some(tag => tag.toLowerCase().includes(query)))
            );
            renderTerms(filtered, 'az');
            // Then scroll to the letter
            const anchor = document.getElementById(key);
            if (anchor) {
              anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        });

        // Back to top button functionality
        const backToTop = () => {
          const scrollThreshold = 300;
          const scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;

          if (scrollPosition > scrollThreshold) {
            backToTopBtn.style.display = 'block';
          } else {
            backToTopBtn.style.display = 'none';
          }
        };

        window.addEventListener('scroll', backToTop);

        backToTopBtn.addEventListener('click', () => {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      });
    </script>
  </body>
</html>
